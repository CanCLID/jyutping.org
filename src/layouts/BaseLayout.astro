---
import { ClientRouter } from "astro:transitions";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import "@/styles/global.css";
import Chartaudio from "@/components/Chartaudio.astro";
import { I18n, getLocalePath } from "@/i18n/utils";
import { makeTitle } from "@/i18n/pageHeadings";

interface Props {
  title?: string;
  description?: string;
  lang?: string;
  flipTitle?: boolean;
}

const {
  title: originalTitle = "", // Will be filled by `makeTitle` if empty
  description = "標準粵語拼音方案 Standard Cantonese Romanization Scheme",
  lang = I18n.defaultLocale,
  flipTitle = false,
} = Astro.props;

const title = makeTitle(originalTitle, lang, flipTitle);

const umamiWebsiteId = "188fdd26-8e55-42b6-ba73-7d2f58adca11";
const umamiScriptSrc = "https://cloud.umami.is/script.js";
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <meta name="generator" content={Astro.generator} />

    {/* Alternate language links */}
    {I18n.locales.map((locale) => (
      <link
        rel="alternate"
        hreflang={locale.replace("_", "-")}
        href={new URL(getLocalePath(Astro.url.pathname, locale), Astro.url.origin).toString()}
      />
    ))}
    <link
      rel="alternate"
      hreflang="x-default"
      href={new URL(getLocalePath(Astro.url.pathname, I18n.defaultLocale), Astro.url.origin).toString()}
    />

    {/* Basic Meta Tags */}
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="Jyutping, 粵拼, Cantonese, Romanization, language, learning, transcription, input method, cantonese keyboard, jyutping input method, jyutping keyboard"
    />

    {/* Open Graph / Facebook */}
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url.origin} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    {
      /* <meta property="og:image" content={new URL('/og-image.png', Astro.url.origin).toString()} /> */
    }

    {/* Twitter */}
    {/* <meta property="twitter:card" content="summary_large_image" /> */}
    <meta property="twitter:url" content={Astro.url.origin} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    {
      /* <meta property="twitter:image" content={new URL('/og-image.png', Astro.url.origin).toString()} /> */
    }

    <link
      rel="preload"
      href="/ChironHeiHK-lshk-subset.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/chiron-hei-hk/woff2/chironheihkvf.A_LGC.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />

    {lang === "ja" && (
      <>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" />
      </>
    )}

    {/* Umami Analytics */}
    <script is:inline defer src={umamiScriptSrc} data-website-id={umamiWebsiteId}
    ></script>

    <ClientRouter />
  </head>
  <body class="antialiased bg-white text-gray-800 flex flex-col min-h-screen">
    <Header />
    <main class="flex-grow">
      <slot />
      <Chartaudio />
    </main>
    <Footer />
  </body>
</html>

<style is:global>
  @import url("/chiron-hei-hk/css/vf.css");
  @font-face {
    font-family: "Chiron Hei HK Jyutping";
    src: url("/ChironHeiHK-lshk-subset.woff2") format("woff2");
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }

  :root {
    --accent: 136, 58, 234;
    --accent-light: 224, 204, 250;
    --accent-gradient: linear-gradient(
      45deg,
      rgb(var(--accent)),
      rgb(var(--accent-light)) 30%,
      white 60%
    );
    --fallback-fonts:
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      Roboto,
      Oxygen,
      Ubuntu,
      Cantarell,
      "Open Sans",
      "Helvetica Neue",
      sans-serif;
  }

  html {
    font-family: var(--fallback-fonts);
    background-size: 224px;
  }

  html:not(:lang(ja)), html :not(:lang(ja)) {
    font-family: "Chiron Hei HK WS", var(--fallback-fonts);
  }

  html:lang(ja), html :lang(ja) {
    font-family: "Noto Sans JP", var(--fallback-fonts);
  }

  html .font-jyutping {
    font-family: "Chiron Hei HK Jyutping", var(--fallback-fonts);
  }

  /* --- Custom Horizontal Slide View Transitions --- */
  @keyframes slide-left-out {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(-30px);
      opacity: 0;
    }
  }

  @keyframes slide-right-in {
    from {
      transform: translateX(30px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  ::view-transition-old(root) {
    animation: slide-left-out 0.2s cubic-bezier(0, 0, 0.2, 1) forwards;
  }

  ::view-transition-new(root) {
    animation: slide-right-in 0.2s cubic-bezier(0, 0, 0.2, 1) forwards;
  }
  /* --- End Custom Horizontal Slide View Transitions --- */
</style>
