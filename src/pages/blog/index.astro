---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogIndexList from "@/components/BlogIndexList.tsx";
import { I18n } from "@/i18n/utils";
import { getTitle } from "@/i18n/pageHeadings";
import { getBlogLabels } from "@/i18n/blogLabels";

// Fetch blog posts for Cantonese
const postsData = await getCollection("blog", ({ id }) =>
  id.startsWith(`${I18n.defaultLocale}/`)
);

// Prepare posts prop for the component
const posts = postsData.map((post) => ({
  title: post.data.title,
  slug: `/blog/${post.slug.substring(4)}`,
  description: post.data.description,
}));

// Get translations for Cantonese
const title = getTitle("blog", I18n.defaultLocale);
const blogLabels = getBlogLabels(I18n.defaultLocale);
---

<BaseLayout lang={I18n.defaultLocale} title={title}>
  <BlogIndexList posts={posts} translations={{ title, ...blogLabels }} client:load />
</BaseLayout>
