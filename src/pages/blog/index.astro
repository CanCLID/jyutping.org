---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogIndexList from "@/components/BlogIndexList.tsx";
import { I18n } from "@/i18n/utils";

// Fetch blog posts for Cantonese
const postsData = await getCollection("blog", ({ id }) =>
  id.startsWith(`${I18n.defaultLocale}/`)
);

// Prepare posts prop for the component
const posts = postsData.map((post) => ({
  title: post.data.title,
  slug: `/blog/${post.slug.substring(4)}`,
  description: post.data.description,
}));

const translations = {
  yue: { title: "文章", readMore: "閱讀全文", noPosts: "暫時冇文章。" },
  en: { title: "Blog", readMore: "Read more", noPosts: "No posts found yet." },
};
const t = translations[I18n.defaultLocale] || translations.en; // Fallback to English

const pageTitle = `${t.title} - 粵拼 Jyutping`;
---

<BaseLayout lang={I18n.defaultLocale} title={pageTitle}>
  <BlogIndexList posts={posts} translations={t} client:load />
</BaseLayout>
