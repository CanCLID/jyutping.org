---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import TableOfContents from "@/components/TableOfContents";
import BaseLayout from "@/layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const learnEntries = await getCollection("learn", ({ id }) => {
    return id.startsWith("yue/");
  });

  return learnEntries.map((entry) => {
    const slugParam = entry.slug.substring(4);
    return {
      params: { slug: slugParam === "" ? undefined : slugParam },
      props: { entry },
    };
  });
}

interface Props {
  entry: CollectionEntry<"learn">;
}
const { entry } = Astro.props;
const { Content, headings } = await entry.render();

const lang = entry.id.split("/")[0] || "yue";
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  lang={lang}
>
  <div class="flex justify-center gap-8 px-4 py-8 max-w-5xl mx-auto">
    <article class="prose flex-grow">
      <h1>{entry.data.title}</h1>
      {entry.data.description && <p class="lead">{entry.data.description}</p>}
      <hr class="my-4" />
      <Content />
    </article>

    <aside class="hidden lg:block w-64 flex-shrink-0">
      <div class="sticky top-16">
        <TableOfContents client:load headings={headings} />
      </div>
    </aside>
  </div>
</BaseLayout>
