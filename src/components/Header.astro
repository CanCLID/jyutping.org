---
// src/components/Header.astro
import { IconMenu2 } from "@tabler/icons-react";
import LanguageSwitcher from "@/components/LanguageSwitcher.tsx"; // Import the React component (.tsx)

// Get current locale and pathname from Astro's global
const { currentLocale, url } = Astro;
const pathname = url.pathname; // Get the current pathname
const locale = currentLocale || "yue"; // Fallback to default if undefined

// --- Navigation Translations (copied from Next.js layout) ---
const navTranslations: Record<string, Record<string, string>> = {
  learn: {
    yue: "學粵拼",
    en: "Learn Jyutping",
    vi: "Học Việt bính",
    nan: "學粵拼",
    wuu: "學粵拼",
    cmn: "學粵拼",
  },
  jyutping: {
    yue: "粵拼方案",
    en: "Jyutping Scheme",
    vi: "Việt bính",
    nan: "粵拼方案",
    wuu: "粵拼方案",
    cmn: "粵拼方案",
  },
  blog: {
    yue: "文集",
    en: "Blog",
    vi: "Tập văn",
    nan: "文集",
    wuu: "文集",
    cmn: "文集",
  },
  keyboard: {
    yue: "輸入法工具",
    en: "Keyboard Tools",
    vi: "Bàn phím tiếng Quảng Đông",
    nan: "輸入法工具",
    wuu: "輸入法工具",
    cmn: "輸入法工具",
  },
  about: {
    yue: "關於",
    en: "About",
    vi: "Liên lạc",
    nan: "關於",
    wuu: "關於",
    cmn: "關於",
  },
};

// --- Generate Localized Nav Links ---
const navLinkKeys = ["learn", "jyutping", "blog", "keyboard", "about"];
const navLinks = navLinkKeys.map((key) => {
  const baseHref = `/${key}`;
  // Prepend locale prefix only if it's not the default locale
  const href = locale === "yue" ? baseHref : `/${locale}${baseHref}`;
  return {
    href: href,
    title: navTranslations[key]?.[locale] || key, // Fallback to key name
  };
});

// Determine the correct base path for the logo link
const logoHref = locale === "yue" ? "/" : `/${locale}`;

const locales = ["en", "vi", "yue", "cmn", "nan", "wuu"];
const defaultLocale = "yue";
---

<header class="relative p-4 bg-[#1678d3] text-white">
  <div class="flex justify-between items-center px-4">
    <a href={logoHref} class="text-white hover:opacity-80">
      <span class="text-3xl font-chiron-hei">粵拼</span>
      {/* Use font class */}
    </a>

    {/* Desktop Navigation */}
    <nav class="hidden md:flex space-x-12">
      {
        navLinks.map((link) => (
          <a href={link.href} class="text-white text-lg hover:opacity-90">
            {link.title}
          </a>
        ))
      }
    </nav>

    {/* Desktop Language Switcher */}
    <div class="hidden md:block">
      {/* Use client:load to hydrate the React component */}
      <LanguageSwitcher
        locales={locales}
        defaultLocale={defaultLocale}
        currentPathname={pathname}
        client:load
      />
    </div>

    {/* Mobile Menu Button */}
    <button
      type="button"
      class="md:hidden text-white"
      aria-label="Toggle menu"
      id="mobile-menu-button"
    >
      <IconMenu2 size={24} />
    </button>

    {/* Mobile Menu Panel (hidden by default) */}
    <div
      id="mobile-menu-panel"
      class="bg-[#1678d3] text-white absolute top-full left-0 right-0 z-50 shadow-md md:hidden hidden"
    >
      <div class="px-8 py-4 flex flex-col space-y-4">
        {/* Mobile Navigation Links */}
        <nav class="flex flex-col space-y-2">
          {
            navLinks.map((link) => (
              <a href={link.href} class="text-white text-lg hover:opacity-80">
                {link.title}
              </a>
            ))
          }
        </nav>
        {/* Mobile Language Switcher */}
        <LanguageSwitcher
          locales={locales}
          defaultLocale={defaultLocale}
          currentPathname={pathname}
          client:load
        />
      </div>
    </div>
  </div>
</header>

<script>
  // Simple script to toggle mobile menu visibility
  const menuButton = document.getElementById("mobile-menu-button");
  const menuPanel = document.getElementById("mobile-menu-panel");

  if (menuButton && menuPanel) {
    menuButton.addEventListener("click", () => {
      menuPanel.classList.toggle("hidden");
    });

    // Optional: Close menu when a link inside it is clicked
    menuPanel.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        menuPanel.classList.add("hidden");
      });
    });
  }
</script>
